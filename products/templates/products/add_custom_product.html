{% extends "base.html" %}
{% load static %}

{% block content %}
  <div class="uk-container uk-container-medium">
    <!-- Page title -->
    <h1 class="uk-heading-line uk-text-center uk-margin-medium-bottom">
      <span>Custom Artwork</span>
    </h1>
    <!-- Product cart -->
    <div class="uk-flex uk-flex-center uk-child-width-expand@s" uk-grid>
      <div class="uk-width-1-2@m">
        <div class="uk-card uk-card-default uk-card-body">
          <p>Custom Artwork Description</p>
          <!-- Form -->
          <form method="POST" action="{% url 'add_custom_product' %}" enctype="multipart/form-data" id="add_custom_product_form">
            <fieldset class="uk-fieldset">
              {% csrf_token %}
              <!-- User input fields -->
              <div class="uk-margin">
                {{ form.type|as_crispy_field }}
                {{ form.format|as_crispy_field }}
                {{ form.description|as_crispy_field }}
                {{ form.image|as_crispy_field }}
              </div>
              <!-- Required but hidden crispy fields -->
              <div class="uk-margin uk-hidden">
                {{ form.category|as_crispy_field }}
                {{ form.sku|as_crispy_field }}
                {{ form.name|as_crispy_field }}
                {{ form.price|as_crispy_field }}
                {{ form.rating|as_crispy_field }}
              </div>
              <p class="uk-text-small">Add a reference image.</p>
              <hr class="uk-margin">
              <div class="uk-text-right uk-margin-top">
                <a class="uk-button uk-button-default uk-border-pill" href="{% url 'products' %}">Cancel</a>
                <button class="uk-button uk-button-primary uk-border-pill" type="submit">Add Product</button>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

<!-- Notifying the user of what the image will be changed to -->
{% block postloadjs %}
  {{ block.super }}
  <script type="text/javascript">
    // Listen to change event on #new-image
    $('#new-image').change(function() {
      // Store new file in variable file
      var file = $('#new-image')[0].files[0];
      // Set file name paragraph in widget template to file name
      $('#filename').text(`Image will be set to: ${file.name}`);
    });

    // Get type and format from form to calc custom product price on submit
    function handleSubmit() {
      // Variables
      let value;
      let cost;
      // Evaluate fees based on image type - Price table 1
      switch (parseInt(document.getElementById("id_type").value)) {
        case 1:
          value = 160;
          break;
        case 2:
          value = 120;
          break;
        case 3:
          value = 80;
          break;
        default:
          value = 50;
      };
      // Get cost based on format choice - Price table 2
      switch (parseInt(document.getElementById("id_format").value)) {
        case 1:
          cost = 20;
          break;
        case 2:
          cost = 30;
          break;
        case 3:
          cost = 40;
          break;
        case 4:
          cost = 50;
          break;
        case 5:
          cost = 60;
          break;
        case 6:
          cost = 70;
          break;
        case 7:
          cost = 80;
          break;
        case 8:
          cost = 90;
          break;
        case 9:
          cost = 100;
          break;
        case 10:
          cost = 110;
          break;
        default:
          cost = 20;
      };
      // Calculate custom product price
      let customPrice = value + cost;
      // Update price value in form element
      customProduct.elements['id_price'].value = customPrice;
    };
    // Save form id as variable
    let customProduct = document.getElementById('add_custom_product_form');
    // Listen to submit event, executes 'handleSubmit' function to calc price
    customProduct.addEventListener('submit', handleSubmit);
  </script>
{% endblock %}