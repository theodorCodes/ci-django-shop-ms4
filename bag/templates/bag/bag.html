{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="uk-container uk-container-medium">

  <h1 class="uk-heading-line uk-text-center">
    <span>Shopping bag</span>
  </h1>

  {% if bag_items %}

    <!-- Test bag items -->
    {{ bag_items }}
    {{ request.session.bag }}
    <!-- END Test bag items -->
  
    <!-- Shopping bag items -->
    <table class="uk-table uk-table-middle uk-table-divider">
      <thead>
        <tr>
          <th class="uk-width-small"></th>
          <th>Product Description</th>
          <th>Price</th>
          <th>Qty</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <!-- Iterate through bag_items -->
        {% for item in bag_items %}
        <tr>
          <td>
            {% if item.product.image %}
              <!-- uikit LIGHTBOX -->
              <img src="{{ item.product.image.url }}" 
                 width="500" 
                   alt="{{ product.name }}">
              </div>
            {% else %}
              <img src="{% static 'images/noimage.png' %}" 
                 width="500" 
                   alt="{{ product.name }}">
            {% endif %}
          </td>
          <td>
            {{ item.product.name }}
            <p>Format: {% if item.product.has_formats %}{{ item.size|upper }}{% else %}N/A{% endif %}</p>
          </td>
          <td>${{ item.product.price }}</td>
          <td>{{ item.quantity }}</td>
          <td>${{ item.product.price }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <!-- Summary and checkout button -->
    <div class="uk-card uk-card-default uk-card-body uk-width-1-3@m uk-align-right">
      <p class="uk-text-default uk-text-right">Bag Total: ${{ total|floatformat:2 }}</p>
      <p class="uk-text-default uk-text-right">Delivery: ${{ delivery|floatformat:2 }}</p>
      <p class="uk-text-default uk-text-right uk-text-bold uk-text-secondary">Grand Total: ${{ grand_total|floatformat:2 }}</p>
      {% if free_delivery_delta > 0 %}
        <p class="uk-text-small uk-text-right">
          You could get free delivery by spending just <strong>${{ free_delivery_delta }}</strong> more!
        </p>
      {% endif %}
      <p class="uk-align-right uk-margin-remove-left">
        <a href="{% url 'products' %}" class="uk-button uk-button-default uk-border-pill">Keep Shopping</a>
        <a href="#" class="uk-button uk-button-secondary uk-margin-small-left uk-align-right  uk-border-pill">Checkout</a>
      </p>
    </div>

  {% else %}
    <!-- Default - empty shopping cart -->
    <div class="uk-flex uk-flex-center">
      <div>Your shopping bag is empty.</div>
    </div>
    <div class="uk-flex uk-flex-center uk-margin-medium-top">
      <a href="{% url 'products' %}" class="uk-button uk-button-primary uk-text-capitalize uk-border-pill">
        Keep Shopping
      </a>
    </div>
  {% endif %}

</div>

{% endblock %}